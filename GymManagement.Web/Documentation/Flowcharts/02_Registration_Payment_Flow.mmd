%% QUY TRÃŒNH ÄÄ‚NG KÃ GÃ“I Táº¬P VÃ€ THANH TOÃN
%% Tá»‘i Æ°u cho Draw.io import

flowchart TD
    A[Chá»n gÃ³i táº­p] --> B[Nháº­p thÃ´ng tin cÃ¡ nhÃ¢n]
    B --> C{CÃ³ mÃ£ giáº£m giÃ¡?}
    C -->|CÃ³| D[Validate mÃ£ giáº£m giÃ¡]
    D --> E{MÃ£ há»£p lá»‡?}
    E -->|KhÃ´ng| F[ThÃ´ng bÃ¡o mÃ£ khÃ´ng há»£p lá»‡]
    F --> G[TÃ­nh tá»•ng tiá»n gá»‘c]
    E -->|CÃ³| H[Ãp dá»¥ng giáº£m giÃ¡]
    C -->|KhÃ´ng| G
    H --> I[TÃ­nh tá»•ng tiá»n sau giáº£m]
    G --> J{PhÆ°Æ¡ng thá»©c thanh toÃ¡n?}
    I --> J
    J -->|VNPay| K[ðŸ”’ BEGIN TRANSACTION]
    J -->|Tiá»n máº·t| L[Táº¡o pending payment]
    K --> M[Táº¡o VNPay URL]
    M --> N[Redirect to VNPay]
    N --> O{Thanh toÃ¡n thÃ nh cÃ´ng?}
    O -->|KhÃ´ng| P[ðŸ”„ ROLLBACK TRANSACTION]
    O -->|CÃ³| Q[KÃ­ch hoáº¡t gÃ³i táº­p]
    L --> R[Admin xÃ¡c nháº­n]
    R --> Q
    Q --> S[ðŸ”’ COMMIT TRANSACTION]
    S --> T[Gá»­i email xÃ¡c nháº­n]
    T --> U[HoÃ n táº¥t Ä‘Äƒng kÃ½]

    %% Styling
    classDef startNode fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef successNode fill:#e8f5e8,stroke:#388e3c,stroke-width:2px
    classDef errorNode fill:#ffebee,stroke:#d32f2f,stroke-width:2px
    classDef decisionNode fill:#e1f5fe,stroke:#0288d1,stroke-width:2px

    class A startNode
    class U successNode
    class F,P errorNode
    class C,E,J,O decisionNode
